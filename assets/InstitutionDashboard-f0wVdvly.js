import{c as P,r,o as Qe,j as e,S as z,C as ge,a as fe,L as be,X as Ze,b as Ke,d as et,M as tt,e as D,s as ye,f as Ne,g as $,h as Z,i as st,k as K,q as je,w as we,l as ve}from"./index-BNtek14H.js";import{g as at,i as ke,Z as Ce,C as Se,c as ee,r as rt,a as nt,h as lt,E as it,b as ot}from"./html2canvas.esm-D3sWM2JN.js";import{f as Ie,Q as ct,g as dt,h as xt}from"./helpers-B5wpkohg.js";import{D as De,F as ut,Q as $e}from"./index-BCkHKH7b.js";import{L as q}from"./loader-circle-CBMaLlQy.js";const ht=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],mt=P("chart-column",ht);const pt=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],gt=P("chevron-left",pt);const ft=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],te=P("circle-plus",ft);const bt=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],yt=P("clock",bt);const Nt=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],se=P("users",Nt),Pt=()=>{const[o,T]=r.useState({studentName:"",studentId:"",courseName:"",grade:"First Class",issueDate:new Date().toISOString().split("T")[0],email:"",institutionName:"MDM Maritime Academy",certificateType:"Permanent",studentPhotoBase64:"",institutionLogoBase64:""}),[x,m]=r.useState(!1),[y,N]=r.useState(0),[Pe,U]=r.useState(!1),[i,ae]=r.useState(null),[A,c]=r.useState(""),[j,w]=r.useState(""),[X,F]=r.useState(!0),[re,jt]=r.useState(at()),[_,ne]=r.useState([]),[wt,Te]=r.useState([]),[v,le]=r.useState({total:0,month:0,today:0,pending:0,rate:100}),[p,ie]=r.useState(""),[M,Ae]=r.useState(""),[f,R]=r.useState(1),[Fe,Me]=r.useState(3),[vt,oe]=r.useState(!1),[ce,de]=r.useState(null),[B,G]=r.useState(null),[xe,Re]=r.useState([]),[Ee,Le]=r.useState("registry"),[He,V]=r.useState(!1),[b,E]=r.useState({studentName:"",studentId:"",email:""}),Y=r.useRef(null),[kt,ue]=r.useState(!1),k=10,J=async t=>{const s=t||D.currentUser?.uid;if(s)try{const a=je(K($,"certificates"),we("issuerId","==",s)),u=(await ve(a)).docs.map(n=>({id:n.id,...n.data()})).sort((n,d)=>(d.timestamp?.seconds||0)-(n.timestamp?.seconds||0));ne(u),_e(u),qe(),he(s)}catch(a){console.error("Error fetching certificates:",a)}},he=async t=>{const s=t||D.currentUser?.uid;if(s)try{const a=je(K($,"students"),we("issuerId","==",s)),u=(await ve(a)).docs.map(n=>({id:n.id,...n.data()}));Re(u)}catch(a){console.error("Error fetching students:",a)}},Oe=async t=>{t.preventDefault();const s=D.currentUser?.uid;if(!s){console.warn("Student addition attempted without authenticated user."),c("You must be logged in to add students.");return}try{m(!0),c(""),await st(K($,"students"),{...b,issuerId:s,institutionName:o.institutionName,issuerAddress:j,addedAt:Z()}),V(!1),E({studentName:"",studentId:"",email:""}),he(s)}catch(a){console.error("Firestore Add Student Error:",a),c(`Failed to add student: ${a.message||"Unknown error"}`)}finally{m(!1)}},ze=t=>{T(s=>({...s,studentName:t.studentName,studentId:t.studentId,email:t.email})),Le("registry"),window.scrollTo({top:0,behavior:"smooth"})},qe=async(t=Fe)=>{oe(!0);try{const s=await ot(t);Te(s),Me(t)}finally{oe(!1)}};r.useEffect(()=>{const t=Qe(D,s=>{s?J(s.uid):(ne([]),le({total:0,month:0,today:0,pending:0,rate:100}))});return Ue(),window.ethereum&&window.ethereum.on("accountsChanged",s=>{const a=s[0]||"";console.log(`[Dashboard] Account changed to: ${a}`),w(a),F(!1),W(a)}),()=>t()},[]);const Ue=async()=>{if(window.ethereum){const t=await window.ethereum.request({method:"eth_accounts"});t.length>0&&(w(t[0]),W(t[0]))}},W=async t=>{if(t){m(!0);try{const s=await ke(t);F(s),s?A&&A.includes("not an authorized issuer")&&c(""):c(`Wallet ${t.substring(0,6)}...${t.substring(38)} is not an authorized issuer.`)}catch(s){console.error("Auth check error:",s)}finally{m(!1)}}},Xe=async()=>{try{c(""),m(!0);const t=await ee();t&&(console.log(`[Dashboard] Connected to: ${t}`),w(t),await W(t))}catch(t){console.error("[Dashboard] Connection error:",t),c(t.message||"Failed to connect wallet.")}finally{m(!1)}},_e=t=>{const s=new Date,a=s.toISOString().split("T")[0],l=s.getMonth(),u=s.getFullYear(),n={total:t.length,today:t.filter(d=>d.issueDate===a).length,month:t.filter(d=>{const S=new Date(d.issueDate);return S.getMonth()===l&&S.getFullYear()===u}).length,pending:t.filter(d=>d.status==="pending").length,rate:t.length>0?t.filter(d=>d.status==="confirmed").length/t.length*100:100};le(n)},g=t=>{const{name:s,value:a}=t.target;T(l=>({...l,[s]:a}))},me=t=>{const{name:s,files:a}=t.target;if(a&&a[0]){const l=new FileReader;l.onload=u=>{T(n=>({...n,[s]:u.target.result}))},l.readAsDataURL(a[0])}},Be=()=>!o.studentName||!o.studentId||!o.courseName||!o.issueDate?(c("Please fill in all required fields."),!1):new Date(o.issueDate)>new Date?(c("Issue date cannot be in the future."),!1):!0,Ge=t=>{t.preventDefault(),Be()&&(c(""),U(!0))},Ve=async t=>{G(null),de(t.certId),c("");try{const a=await(await rt(t.certId)).wait();await ye(Ne($,"certificates",t.certId),{status:"revoked",revokedAt:Z(),revokeTxHash:a.hash},{merge:!0}),J()}catch(s){console.error(s),c(s.message||"Failed to revoke certificate.")}finally{de(null)}},Ye=async()=>{c(""),m(!0);try{const t=await ee();if(console.log(`[Dashboard] Pre-issuance check for: ${t}`),!await ke(t))throw F(!1),new Error(`Your wallet (${t.substring(0,6)}...) is not an authorized issuer.`);F(!0),w(t)}catch(t){c(t.message),m(!1);return}U(!1),N(1);try{const t=dt(),s={certId:t,...o,issuerAddress:j,issuerId:D.currentUser.uid,issueDate:o.issueDate},a=xt(s);N(2);let l=j;if(!l){if(l=await ee(),!l)throw new Error("Please connect MetaMask.");w(l),s.issuerAddress=l}const n=await(await nt(t,a)).wait();N(3);const d=await fetch("http://localhost:5000/api/certificates/anchor-to-ipfs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,certHash:a,txHash:n.hash})}),S=d.headers.get("content-type");let H;if(S&&S.includes("application/json"))H=await d.json();else{const h=await d.text();throw console.error("Non-JSON response received:",h),new Error("Server returned an invalid response (not JSON). Please check the backend logs.")}if(!d.ok)throw new Error(H.error||`IPFS error: ${d.status} ${d.statusText}`);N(4);const O={...s,certHash:a,txHash:n.hash,blockNumber:Number(n.blockNumber),ipfsHash:H.ipfsHash,gatewayUrl:H.gatewayUrl,timestamp:Z(),status:"confirmed"};try{console.log("Requesting Digital Signature...");const h=await fetch("http://localhost:5000/api/auth/sign",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hash:a})});if(h.ok){const I=await h.json();console.log("Signature Response:",I),I.signature?(O.digitalSignature=I.signature,console.log("Digital Signature added successfully.")):console.warn("Signature response missing 'signature' field")}else{console.warn(`Signature Service Error: ${h.status} ${h.statusText}`);const I=await h.text();console.warn("Error Details:",I)}}catch(h){console.error("Signature generation EXCEPTION:",h)}await ye(Ne($,"certificates",t),O),ae(O),N(5),T(h=>({studentName:"",studentId:"",courseName:"",grade:"First Class",issueDate:new Date().toISOString().split("T")[0],email:"",institutionName:h.institutionName,certificateType:"Permanent",studentPhotoBase64:"",institutionLogoBase64:""})),J(),setTimeout(()=>{We(O)},1e3)}catch(t){console.error(t),c(t.reason||t.message||"Failed to issue certificate."),N(0)}finally{m(!1)}},Je=()=>{const t=[`Cert ID,Student Name,Student ID,Course,Grade,Issue Date,Hash,TxHash
`],s=_.map(n=>`${n.certId},${n.studentName},${n.studentId},${n.courseName},${n.grade},${n.issueDate},${n.certHash},${n.txHash}`).join(`
`),a=new Blob([t+s],{type:"text/csv"}),l=window.URL.createObjectURL(a),u=document.createElement("a");u.href=l,u.download=`Certificates_${new Date().toISOString().split("T")[0]}.csv`,u.click()},We=async(t=i)=>{if(!(!Y.current||!t)){ue(!0);try{const a=(await lt(Y.current,{scale:2,useCORS:!0,backgroundColor:"#ffffff"})).toDataURL("image/jpeg",.95);console.log("PDF generation: Image data length:",a.length);const l=new it("l","mm","a4"),u=l.getImageProperties(a),n=l.internal.pageSize.getWidth(),d=u.height*n/u.width;l.addImage(a,"JPEG",0,0,n,d),l.save(`Certificate_${t.certId}.pdf`)}catch(s){console.error("PDF generation failed:",s)}finally{ue(!1)}}},C=r.useMemo(()=>_.filter(t=>{const s=t.studentName.toLowerCase().includes(p.toLowerCase())||t.studentId.toLowerCase().includes(p.toLowerCase())||t.certId.toLowerCase().includes(p.toLowerCase()),a=M?t.issueDate===M:!0;return s&&a}),[_,p,M]),pe=r.useMemo(()=>{const t=(f-1)*k;return C.slice(t,t+k)},[C,f]),Q=Math.ceil(C.length/k),L=({step:t,label:s,currentStep:a})=>e.jsxs("div",{className:`flex items-center space-x-3 transition-all ${a>=t?"text-primary font-bold":"text-gray-300"}`,children:[e.jsx("div",{className:`h-6 w-6 rounded-full flex items-center justify-center text-xs border-2 ${a>t?"bg-primary border-primary text-white":a===t?"border-primary animate-pulse":"border-gray-200"}`,children:a>t?"✓":t}),e.jsx("span",{className:"text-sm",children:s}),a===t&&e.jsx(q,{className:"h-4 w-4 animate-spin"})]});return e.jsxs("div",{className:"py-24 space-y-10 max-w-7xl mx-auto px-4",children:[e.jsxs("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-black text-gray-900 tracking-tight flex items-center gap-2",children:[e.jsx(z,{className:"h-10 w-10 text-primary"}),"Registry Management"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("p",{className:"text-gray-500 font-medium",children:"Issue, manage, and track blockchain-verified credentials."}),e.jsx("span",{className:`px-2 py-0.5 ${re.badgeColor} text-white text-[9px] font-black rounded-lg uppercase tracking-widest animate-in fade-in slide-in-from-left-2`,children:re.label})]})]}),e.jsx("div",{className:"flex items-center gap-4 bg-white p-2 rounded-2xl shadow-sm border border-gray-100",children:j?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex flex-col items-end text-right pr-2 border-r border-gray-100",children:[e.jsx("span",{className:"text-[9px] font-black text-gray-400 uppercase tracking-widest",children:"Active Wallet"}),e.jsx("span",{className:"text-[11px] font-mono font-bold text-gray-900 truncate w-24",children:j})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-green-50 rounded-xl",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${X?"bg-success":"bg-error"} animate-pulse`}),e.jsx("span",{className:`text-[9px] font-black uppercase tracking-widest ${X?"text-success":"text-error"}`,children:X?"Shield Active":"Not Authorized"})]})]}):e.jsxs("button",{onClick:Xe,className:"flex items-center gap-2 px-5 py-2.5 bg-primary text-white rounded-xl font-black text-xs hover:bg-primary-hover transition shadow-lg shadow-primary/10 active:scale-95 disabled:opacity-50",disabled:x,children:[e.jsx(Ce,{className:"h-3 w-3 fill-white"}),x?"Checking...":j?"Re-sync Wallet":"Connect MetaMask"]})})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[{label:"Total Certificates",val:v.total,icon:se,color:"text-blue-600",bg:"bg-blue-50"},{label:"Issued This Month",val:v.month,icon:Se,color:"text-purple-600",bg:"bg-purple-50"},{label:"Issued Today",val:v.today,icon:Ce,color:"text-yellow-600",bg:"bg-yellow-50"},{label:"Pending",val:v.pending,icon:yt,color:"text-orange-600",bg:"bg-orange-50"},{label:"Success Rate",val:`${Math.round(v.rate)}%`,icon:mt,color:"text-green-600",bg:"bg-green-50"}].map((t,s)=>e.jsxs("div",{className:"bg-white p-5 rounded-3xl border border-border shadow-sm hover:shadow-md transition-all duration-300 group",children:[e.jsx("div",{className:`h-10 w-10 ${t.bg} ${t.color} rounded-2xl flex items-center justify-center mb-3 group-hover:scale-110 transition`,children:e.jsx(t.icon,{className:"h-5 w-5"})}),e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:t.label}),e.jsx("p",{className:"text-2xl font-black text-gray-900",children:t.val})]},s))}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-10",children:[e.jsxs("section",{className:"lg:col-span-1 bg-white p-8 rounded-[2.5rem] shadow-xl border border-border space-y-8 relative overflow-hidden transition-all duration-300 hover:shadow-2xl",children:[e.jsx("div",{className:"absolute top-0 right-0 p-8 opacity-5",children:e.jsx(z,{className:"h-32 w-32"})}),e.jsxs("div",{className:"space-y-2 relative",children:[e.jsx("h2",{className:"text-2xl font-black text-gray-900",children:"Issue Certificate"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Create a permanent record for a student."})]}),e.jsxs("form",{onSubmit:Ge,className:"space-y-5",children:[e.jsxs("div",{className:"grid gap-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Student Name"}),e.jsx("input",{type:"text",name:"studentName",required:!0,className:"w-full px-5 py-3.5 bg-gray-50 border-2 border-border rounded-2xl focus:bg-white focus:ring-4 focus:ring-primary-hover/20 transition-all outline-none",placeholder:"e.g. John Doe",value:o.studentName,onChange:g,disabled:x})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Institution Name"}),e.jsx("input",{type:"text",name:"institutionName",required:!0,className:"w-full px-5 py-3.5 bg-gray-50 border-2 border-border rounded-2xl focus:bg-white focus:ring-4 focus:ring-primary-hover/20 transition-all outline-none",placeholder:"e.g. MREM College",value:o.institutionName,onChange:g,disabled:x})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Student ID"}),e.jsx("input",{type:"text",name:"studentId",required:!0,className:"w-full px-5 py-3.5 bg-gray-50 border-2 border-border rounded-2xl focus:bg-white focus:ring-4 focus:ring-primary-hover/20 transition-all outline-none uppercase font-bold tracking-tight",placeholder:"e.g. CS2024001",value:o.studentId,onChange:g,disabled:x})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Course Name"}),e.jsx("input",{type:"text",name:"courseName",required:!0,className:"w-full px-5 py-3.5 bg-gray-50 border-2 border-border rounded-2xl focus:bg-white focus:ring-4 focus:ring-primary-hover/20 transition-all outline-none",placeholder:"e.g. Full Stack Development",value:o.courseName,onChange:g,disabled:x})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Grade"}),e.jsxs("select",{name:"grade",className:"w-full px-4 py-3.5 bg-gray-50 border-2 border-border rounded-2xl focus:bg-white focus:ring-4 focus:ring-primary-hover/20 transition-all outline-none",value:o.grade,onChange:g,disabled:x,children:[e.jsx("option",{children:"First Class"}),e.jsx("option",{children:"Second Class"}),e.jsx("option",{children:"Third Class"}),e.jsx("option",{children:"Pass"}),e.jsx("option",{children:"Distinction"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Issue Date"}),e.jsx("input",{type:"date",name:"issueDate",required:!0,className:"w-full px-4 py-3.5 bg-gray-50 border-2 border-border rounded-2xl focus:bg-white focus:ring-4 focus:ring-primary-hover/20 transition-all outline-none",value:o.issueDate,onChange:g,max:new Date().toISOString().split("T")[0],disabled:x})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Email (Optional)"}),e.jsx("input",{type:"email",name:"email",className:"w-full px-5 py-3.5 bg-gray-50 border-2 border-border rounded-2xl focus:bg-white focus:ring-4 focus:ring-primary-hover/20 transition-all outline-none",placeholder:"student@example.com",value:o.email,onChange:g,disabled:x})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Student Photo"}),e.jsx("input",{type:"file",name:"studentPhotoBase64",accept:"image/*",className:"w-full px-4 py-2.5 bg-gray-50 border-2 border-border rounded-2xl text-[10px] focus:bg-white transition-all outline-none",onChange:me,disabled:x})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Institution Logo"}),e.jsx("input",{type:"file",name:"institutionLogoBase64",accept:"image/*",className:"w-full px-4 py-2.5 bg-gray-50 border-2 border-border rounded-2xl text-[10px] focus:bg-white transition-all outline-none",onChange:me,disabled:x})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Certificate Type"}),e.jsxs("select",{name:"certificateType",className:"w-full px-5 py-3.5 bg-gray-50 border-2 border-border rounded-2xl focus:bg-white transition-all outline-none",value:o.certificateType,onChange:g,disabled:x,children:[e.jsx("option",{value:"Permanent",children:"Permanent"}),e.jsx("option",{value:"Provisional",children:"Provisional"})]})]}),e.jsxs("button",{type:"submit",disabled:x,className:"w-full bg-primary text-white py-4 rounded-2xl font-black text-lg hover:bg-primary-hover transition flex items-center justify-center space-x-3 shadow-xl shadow-primary/10 disabled:opacity-50 active:scale-95",children:[x?e.jsx(q,{className:"h-6 w-6 animate-spin"}):e.jsx(te,{className:"h-6 w-6"}),e.jsx("span",{children:x?"Processing...":"Issue to Blockchain"})]})]}),y>0&&y<5&&e.jsxs("div",{className:"pt-4 space-y-4 border-t border-gray-50 animate-in fade-in slide-in-from-bottom-2",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-gray-400",children:"Transaction Pulse"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(L,{step:1,label:"Calculating Hash",currentStep:y}),e.jsx(L,{step:2,label:"Blockchain Sync",currentStep:y}),e.jsx(L,{step:3,label:"IPFS Anchoring",currentStep:y}),e.jsx(L,{step:4,label:"Global Storage",currentStep:y})]})]}),A&&e.jsx("div",{className:"p-4 bg-red-50 border-l-4 border-error rounded-r-2xl text-error text-xs font-bold animate-in bounce-in",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{children:A})]})})]}),e.jsx("section",{className:"lg:col-span-2 space-y-8",children:e.jsx("div",{className:"bg-white p-8 rounded-[2.5rem] shadow-sm border border-border space-y-6 hover:shadow-md transition-all duration-300",children:Ee==="registry"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fe,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-300"}),e.jsx("input",{type:"text",placeholder:"Search by student, ID or certificate ref...",className:"w-full pl-12 pr-4 py-3.5 bg-gray-50 border border-border rounded-2xl focus:bg-white focus:ring-4 focus:ring-primary-hover/10 outline-none transition-all",value:p,onChange:t=>{ie(t.target.value),R(1)}})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"date",className:"pl-9 pr-3 py-3 bg-gray-50 border border-border rounded-xl text-sm outline-none focus:bg-white hover:border-primary-hover focus:border-primary transition-all",value:M,onChange:t=>{Ae(t.target.value),R(1)}})]}),e.jsxs("button",{onClick:Je,className:"flex items-center space-x-2 px-6 py-3 bg-gray-900 text-white rounded-xl font-bold text-sm hover:bg-black transition shadow-lg active:scale-95",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{children:"Export"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-400 text-[10px] font-black uppercase tracking-widest border-b border-gray-50",children:[e.jsx("th",{className:"pb-4 px-2",children:"Cert ID"}),e.jsx("th",{className:"pb-4",children:"Student"}),e.jsx("th",{className:"pb-4",children:"Course"}),e.jsx("th",{className:"pb-4 text-center",children:"Date"}),e.jsx("th",{className:"pb-4 text-center",children:"Status"}),e.jsx("th",{className:"pb-4 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-50",children:[pe.map(t=>e.jsxs("tr",{className:"group hover:bg-gray-50/50 transition duration-300",children:[e.jsx("td",{className:"py-5 px-2",children:e.jsx(be,{to:`/verify/${t.certId}`,className:"text-primary font-black hover:underline tracking-tight",children:t.certId.split("-").slice(-1)})}),e.jsx("td",{className:"py-5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-gray-900",children:t.studentName}),e.jsx("span",{className:"text-[10px] text-gray-400 uppercase font-black tracking-tight",children:t.studentId})]})}),e.jsx("td",{className:"py-5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 truncate max-w-[150px]",children:t.courseName}),e.jsx("span",{className:"text-[10px] text-primary italic font-bold",children:t.grade})]})}),e.jsx("td",{className:"py-5 text-center text-xs font-bold text-gray-500",children:Ie(t.issueDate)}),e.jsx("td",{className:"py-5 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest ${t.status==="confirmed"?"bg-success/10 text-success border border-success/20":t.status==="revoked"?"bg-red-50 text-error border border-red-100":"bg-warning/10 text-warning border border-warning/20"}`,children:t.status})}),e.jsxs("td",{className:"py-5 text-right flex items-center justify-end gap-2",children:[t.status==="confirmed"&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{t.gatewayUrl?window.open(t.gatewayUrl,"_blank"):(c("IPFS gateway URL not found for this certificate."),setTimeout(()=>c(""),5e3))},className:"p-2 text-gray-400 hover:text-primary hover:bg-blue-50 rounded-lg transition-all",title:"View on IPFS (PDF)",children:e.jsx(ut,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{if(t.ipfsHash){const s=`https://gateway.pinata.cloud/ipfs/${t.ipfsHash}?filename=Certificate_${t.certId}.pdf`;window.open(s,"_blank")}else t.gatewayUrl?window.open(t.gatewayUrl,"_blank"):(c("IPFS Hash not found for this certificate."),setTimeout(()=>c(""),5e3))},className:"p-2 text-gray-400 hover:text-primary hover:bg-blue-50 rounded-lg transition-all",title:"Download stored PDF from IPFS",children:e.jsx(De,{className:"h-4 w-4"})})]}),t.status!=="revoked"&&e.jsx("button",{onClick:()=>G(t),disabled:ce===t.certId,className:"p-2 text-gray-400 hover:text-error hover:bg-red-50 rounded-lg transition-all",title:"Revoke Certificate",children:ce===t.certId?e.jsx(q,{className:"h-4 w-4 animate-spin"}):e.jsx(Ze,{className:"h-4 w-4"})})]})]},t.id)),pe.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"py-20 text-center",children:e.jsxs("div",{className:"flex flex-col items-center opacity-20",children:[e.jsx(ct,{className:"h-16 w-16 mb-2"}),e.jsx("p",{className:"font-black",children:"No records found matching your search"})]})})})]})]})}),Q>1&&e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-50",children:[e.jsxs("p",{className:"text-xs font-bold text-gray-400",children:["Showing ",(f-1)*k+1," to ",Math.min(f*k,C.length)," of ",C.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>R(t=>Math.max(1,t-1)),disabled:f===1,className:"p-2 hover:bg-gray-100 rounded-lg disabled:opacity-20 transition",children:e.jsx(gt,{className:"h-5 w-5"})}),e.jsx("span",{className:"text-sm font-black w-8 text-center",children:f}),e.jsx("button",{onClick:()=>R(t=>Math.min(Q,t+1)),disabled:f===Q,className:"p-2 hover:bg-gray-100 rounded-lg disabled:opacity-20 transition",children:e.jsx(Ke,{className:"h-5 w-5"})})]})]})]}):e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(fe,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-300"}),e.jsx("input",{type:"text",placeholder:"Filter students...",className:"w-full pl-12 pr-4 py-3.5 bg-gray-50 border border-border rounded-2xl focus:bg-white focus:ring-4 focus:ring-primary-hover/10 outline-none transition-all",value:p,onChange:t=>ie(t.target.value)})]}),e.jsxs("button",{onClick:()=>V(!0),className:"flex items-center space-x-2 px-6 py-3 bg-primary text-white rounded-xl font-bold text-sm hover:bg-primary-hover transition shadow-lg active:scale-95",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Student"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-400 text-[10px] font-black uppercase tracking-widest border-b border-gray-50",children:[e.jsx("th",{className:"pb-4 px-2",children:"Student ID"}),e.jsx("th",{className:"pb-4",children:"Name"}),e.jsx("th",{className:"pb-4",children:"Email"}),e.jsx("th",{className:"pb-4 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-50",children:[xe.filter(t=>t.studentName.toLowerCase().includes(p.toLowerCase())||t.studentId.toLowerCase().includes(p.toLowerCase())).map(t=>e.jsxs("tr",{className:"group hover:bg-gray-50/50 transition duration-300",children:[e.jsx("td",{className:"py-5 px-2 font-black text-gray-900 uppercase tracking-tight",children:t.studentId}),e.jsx("td",{className:"py-5 font-bold text-gray-900",children:t.studentName}),e.jsx("td",{className:"py-5 text-sm text-gray-500 font-medium",children:t.email}),e.jsx("td",{className:"py-5 text-right",children:e.jsx("button",{onClick:()=>ze(t),className:"px-4 py-2 bg-primary/10 text-primary rounded-lg text-xs font-black hover:bg-primary hover:text-white transition-all transform active:scale-95",children:"Quick Issue"})})]},t.id)),xe.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"py-20 text-center",children:e.jsxs("div",{className:"flex flex-col items-center opacity-20",children:[e.jsx(se,{className:"h-16 w-16 mb-2"}),e.jsx("p",{className:"font-black",children:"No student records found"})]})})})]})]})})]})})}),B&&e.jsx("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-gray-900/60 backdrop-blur-sm p-4 animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white rounded-[3rem] p-10 max-w-lg w-full shadow-2xl space-y-8 animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"h-20 w-20 bg-red-50 text-error rounded-[2rem] flex items-center justify-center mx-auto shadow-inner",children:e.jsx(ge,{className:"h-10 w-10"})}),e.jsx("h3",{className:"text-3xl font-black text-gray-900",children:"Revoke Credential?"}),e.jsxs("p",{className:"text-gray-500 font-medium leading-relaxed",children:["You are about to invalidate ",e.jsx("span",{className:"text-gray-900 font-bold",children:B.certId}),". This change will be broadcast to the blockchain."]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-4",children:[e.jsx("button",{onClick:()=>G(null),className:"flex-1 py-4 px-6 rounded-2xl font-black border-2 border-border text-gray-400 hover:bg-gray-50 transition active:scale-95",children:"Cancel"}),e.jsx("button",{onClick:()=>Ve(B),className:"flex-1 py-4 px-6 rounded-2xl font-black bg-error text-white hover:bg-red-700 shadow-xl shadow-red-100 transition active:scale-95",children:"Confirm Revocation"})]})]})}),Pe&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-gray-900/60 backdrop-blur-sm p-4 animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white rounded-[3rem] p-10 max-w-lg w-full shadow-2xl space-y-8 animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"h-20 w-20 bg-primary/10 text-primary rounded-[2rem] flex items-center justify-center mx-auto shadow-inner",children:e.jsx(z,{className:"h-10 w-10"})}),e.jsx("h3",{className:"text-3xl font-black text-gray-900",children:"Verify & Issue"}),e.jsxs("p",{className:"text-gray-500 font-medium leading-relaxed",children:["You are about to anchor this certificate to the blockchain. This action is ",e.jsx("span",{className:"text-gray-900 font-bold underline",children:"permanent and immutable"}),"."]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-3xl p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-2",children:[e.jsx("span",{className:"text-xs font-black text-gray-400 uppercase tracking-widest",children:"Student"}),e.jsx("span",{className:"font-bold text-gray-900",children:o.studentName})]}),e.jsxs("div",{className:"flex justify-between items-center px-2",children:[e.jsx("span",{className:"text-xs font-black text-gray-400 uppercase tracking-widest",children:"Course"}),e.jsx("span",{className:"font-bold text-gray-900",children:o.courseName})]}),e.jsxs("div",{className:"flex justify-between items-center px-2",children:[e.jsx("span",{className:"text-xs font-black text-gray-400 uppercase tracking-widest",children:"Institution"}),e.jsx("span",{className:"font-bold text-gray-900",children:o.institutionName})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-4",children:[e.jsx("button",{onClick:()=>U(!1),className:"flex-1 py-4 px-6 rounded-2xl font-black border-2 border-border text-gray-400 hover:bg-gray-50 transition active:scale-95",children:"Go Back"}),e.jsx("button",{onClick:Ye,className:"flex-1 py-4 px-6 rounded-2xl font-black bg-primary text-white hover:bg-primary-hover shadow-xl shadow-primary/10 transition active:scale-95",children:"Confirm Issuance"})]})]})}),i&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-gray-900/60 backdrop-blur-sm p-4 animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white rounded-[3.5rem] p-12 max-w-xl w-full shadow-2xl space-y-10 relative overflow-hidden animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"absolute top-0 right-0 p-12 bg-green-50 rounded-bl-[5rem] -mr-16 -mt-16 pointer-events-none"}),e.jsxs("div",{className:"text-center space-y-3 relative z-10",children:[e.jsx(et,{className:"h-16 w-16 text-success mx-auto drop-shadow-lg"}),e.jsx("h3",{className:"text-4xl font-black text-gray-900 tracking-tight",children:"Proof Anchored!"}),e.jsxs("p",{className:"text-gray-500 font-medium",children:["Integrity proof for ",e.jsx("span",{className:"font-bold text-gray-900",children:i.certId})," has been stored on Polygon.",e.jsx("br",{}),e.jsx("span",{className:"text-[10px] uppercase font-black text-primary bg-primary/5 px-2 py-0.5 rounded-full mt-2 inline-block",children:"Zero Personal Data On-Chain"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-10 bg-gray-50/50 p-8 rounded-[2.5rem] border border-gray-100",children:[e.jsx("div",{className:"bg-white p-4 rounded-3xl shadow-lg shadow-gray-200/50 hover:scale-105 transition duration-500",children:e.jsx($e,{value:`${window.location.origin}/verify/${i.certId}`,size:140,level:"H",includeMargin:!0})}),e.jsxs("div",{className:"space-y-4 flex-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-gray-400",children:"Integrity Hash (SHA-256)"}),e.jsx("p",{className:"font-mono text-[10px] text-gray-900 break-all bg-gray-100 p-2 rounded-lg mt-1",children:i.certHash})]}),e.jsxs("div",{className:"pt-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-gray-400",children:"Student ID"}),e.jsx("p",{className:"font-bold text-gray-900",children:i.studentId})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(be,{to:`/verify/${i.certId}`,className:"flex-1 py-3 bg-gray-900 text-white rounded-xl text-xs font-black text-center hover:bg-black transition",children:"View On-Chain"}),e.jsxs("a",{href:`mailto:${i.email}?subject=Your Certificate is Ready!&body=Hello ${i.studentName}, your certificate for ${i.courseName} from ${i.institutionName} has been issued and anchored on the blockchain. Verifiable at: ${window.location.origin}/verify/${i.certId}`,className:"flex-1 py-3 bg-primary text-white rounded-xl text-xs font-black text-center hover:bg-blue-600 transition flex items-center justify-center gap-2",children:[e.jsx(tt,{className:"h-3 w-3"}),"Share to Student"]})]})]})]}),e.jsx("button",{onClick:()=>ae(null),className:"w-full py-5 rounded-[1.8rem] font-black bg-white border-4 border-border text-gray-900 hover:bg-gray-50 hover:border-primary-hover transition-all shadow-sm active:scale-95",children:"Done, Return to Dashboard"})]})}),He&&e.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-900/60 backdrop-blur-sm p-4 animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white rounded-[3rem] p-10 max-w-lg w-full shadow-2xl space-y-8 animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"h-20 w-20 bg-primary/10 text-primary rounded-[2rem] flex items-center justify-center mx-auto shadow-inner",children:e.jsx(se,{className:"h-10 w-10"})}),e.jsx("h3",{className:"text-3xl font-black text-gray-900",children:"Add New Student"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Create a new student entry in your institution's records."})]}),e.jsxs("form",{onSubmit:Oe,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,placeholder:"e.g. John Doe",className:"w-full px-5 py-3.5 bg-gray-50 border-2 border-border rounded-2xl focus:bg-white focus:ring-4 focus:ring-primary-hover/20 transition-all outline-none",value:b.studentName,onChange:t=>E({...b,studentName:t.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Student ID"}),e.jsx("input",{type:"text",required:!0,placeholder:"e.g. CS2024001",className:"w-full px-5 py-3.5 bg-gray-50 border-2 border-border rounded-2xl focus:bg-white focus:ring-4 focus:ring-primary-hover/20 transition-all outline-none uppercase font-bold tracking-tight",value:b.studentId,onChange:t=>E({...b,studentId:t.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-black text-gray-400 uppercase tracking-widest ml-1",children:"Email Address"}),e.jsx("input",{type:"email",required:!0,placeholder:"student@example.com",className:"w-full px-5 py-3.5 bg-gray-50 border-2 border-border rounded-2xl focus:bg-white focus:ring-4 focus:ring-primary-hover/20 transition-all outline-none",value:b.email,onChange:t=>E({...b,email:t.target.value})})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>V(!1),className:"flex-1 py-4 px-6 rounded-2xl font-black border-2 border-border text-gray-400 hover:bg-gray-50 transition active:scale-95",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:x,className:"flex-1 py-4 px-6 rounded-2xl font-black bg-primary text-white hover:bg-primary-hover shadow-xl shadow-primary/10 transition active:scale-95 flex items-center justify-center gap-2",children:[x?e.jsx(q,{className:"h-5 w-5 animate-spin"}):e.jsx(te,{className:"h-5 w-5"}),"Add Record"]})]})]})]})}),e.jsx("div",{className:"absolute top-[-9999px] left-[-9999px] opacity-0 pointer-events-none",children:e.jsxs("div",{ref:Y,className:"w-[1000px] p-20 bg-white border-[20px] flex flex-col items-center text-center space-y-10 font-sans",style:{borderColor:"#eff6ff",color:"#111827"},children:[e.jsxs("div",{className:"w-full flex justify-between items-start",children:[e.jsx(z,{className:"h-16 w-16",style:{color:"#2E7D32"}}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold tracking-widest uppercase",style:{color:"#d1d5db"},children:"Official Record"}),e.jsx("p",{className:"text-xs font-mono",style:{color:"#9ca3af"},children:i?.certId||"CERT-XXXX-XXXX"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-6xl font-black tracking-tighter",style:{color:"#111827"},children:"Certificate of Completion"}),e.jsx("div",{className:"h-1.5 w-40 mx-auto rounded-full",style:{backgroundColor:"#2E7D32"}})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-xl font-medium italic",style:{color:"#9ca3af"},children:"This is to certify that"}),e.jsx("h2",{className:"text-5xl font-black",style:{color:"#2E7D32"},children:i?.studentName||"Student Name"}),e.jsx("p",{className:"text-xl font-medium max-w-2xl mx-auto",style:{color:"#9ca3af"},children:"has successfully completed the requirements for the course"}),e.jsx("h3",{className:"text-3xl font-bold",style:{color:"#111827"},children:i?.courseName||"Course Name"}),e.jsxs("div",{className:"flex justify-center gap-12 pt-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[10px] uppercase font-black tracking-widest",style:{color:"#d1d5db"},children:"Grade"}),e.jsx("p",{className:"text-lg font-bold",style:{color:"#111827"},children:i?.grade||"Grade"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[10px] uppercase font-black tracking-widest",style:{color:"#d1d5db"},children:"Institution"}),e.jsx("p",{className:"text-lg font-bold",style:{color:"#111827"},children:i?.institutionName||"Institution"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[10px] uppercase font-black tracking-widest",style:{color:"#d1d5db"},children:"Issue Date"}),e.jsx("p",{className:"text-lg font-bold",style:{color:"#111827"},children:Ie(i?.issueDate)||"Date"})]})]})]}),e.jsxs("div",{className:"flex flex-col items-center space-y-4 pt-10 border-t w-full opacity-60",style:{borderColor:"#f9fafb"},children:[e.jsx($e,{value:`${window.location.origin}/verify/${i?.certId||"CERT-XXXX-XXXX"}`,size:80}),e.jsxs("p",{className:"text-[10px] font-black uppercase tracking-[0.3em]",style:{color:"#9ca3af"},children:["VERIFIED ON POLYGON BLOCKCHAIN • #",i?.txHash?.slice(0,12)||"0x..."]})]})]})})]})]})};export{Pt as default};
